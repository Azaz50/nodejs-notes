# CRUD API Project Documentation

This document provides a detailed explanation of the CRUD API project.

## Project Overview

This project is a simple CRUD (Create, Read, Update, Delete) API built with Node.js, Express, and MongoDB. It allows managing a collection of "students", including uploading a profile picture.

The included screenshots provide conceptual background:
- `Screenshot (94).png`: Explains the general concept of an API, where client applications (web or mobile) communicate with a backend server that interacts with a database.
- `Screenshot (95).png`: Shows the basic structure of Express.js routes for handling different HTTP methods (GET, POST, PUT, DELETE), which correspond to CRUD operations.
- `Screenshot (96).png`: Illustrates the core components of `multer` for handling file uploads in Express: Storage, Limits, and File Filter.

## Project Structure

```
crud-api-project-22/
├── .env                  # Environment variables (like database connection string)
├── index.js              # Main application entry point
├── package.json          # Project metadata and dependencies
├── config/
│   └── db.js             # Database connection logic
├── models/
│   └── students.model.js # Mongoose schema and model for students
├── routes/
│   ├── students.route.js # API routes for student operations
│   └── uploads/          # Directory where uploaded images are stored
└── views/                # (Currently unused)
```

---

## File-by-File Explanation

### `index.js` - The Server

This is the heart of the application.

- **`require(...)`**: Imports all necessary modules:
    - `express`: The web server framework.
    - `mongoose`: To connect to and interact with the MongoDB database.
    - `dotenv`: To load secrets from the `.env` file (like the `MONGO_URI`).
    - `./config/db.js`: The custom module for database connection logic.
    - `./routes/students.route.js`: The router containing all student-related API endpoints.

- **`connectDB()`**: Executes the function from `db.js` to establish the database connection when the server starts.

- **`app.use(...)`**: Mounts middleware functions. Middleware are functions that have access to the request (`req`) and response (`res`) objects.
    - **`express.urlencoded({ extended: false })`**: Parses incoming request bodies with URL-encoded payloads. This is how you get data from a standard HTML form.
    - **`express.json()`**: Parses incoming request bodies with JSON payloads. This is common for APIs that communicate with JavaScript frontends.
    - **`app.use('/uploads', express.static('routes/uploads'))`**: This is a crucial addition. It makes the `routes/uploads` directory publicly accessible. Without this, you wouldn't be able to view the uploaded profile pictures from the browser. For example, a file named `123.jpg` can be accessed at `http://localhost:3000/uploads/123.jpg`.
    - **`app.use('/api/students', studentRoutes)`**: This mounts the router from `students.route.js`. It means that any route defined in that file (e.g., `/`) will be accessible under the `/api/students` prefix (e.g., `http://localhost:3000/api/students/`).

- **`app.listen(3000, ...)`**: Starts the server on port 3000.

### `config/db.js` - Database Connector

This file's sole purpose is to connect to MongoDB.

- **`mongoose.connect(process.env.MONGO_URI)`**: It reads the MongoDB connection string from the `.env` file and uses Mongoose to connect to the database. Using `process.env` keeps your secret credentials out of the source code.

### `models/students.model.js` - Data Schema

This file defines the structure of a "student" document in the database.

- **`new mongoose.Schema(...)`**: Defines the fields, their data types, and any constraints for a student.
    - `first_name`, `last_name`, `email`, `phone`, `gender`: These are all defined as `String` type.
    - `profile_pic`: This field of type `String` will store the *filename* of the uploaded image, not the image itself.

- **`mongoose.model('Student', ...)`**: Compiles the schema into a `Student` model, which provides an interface to create, read, update, and delete documents in the `students` collection in MongoDB.

### `routes/students.route.js` - API Endpoints & Image Upload Logic

This file is the most complex. It defines the API routes and contains the logic for handling image uploads using the `multer` library.

#### Image Upload Setup (`multer`)

This was the area with the original bug.

- **`multer.diskStorage(...)`**: Configures how and where `multer` saves uploaded files.
    - **`destination`**: Specifies the directory to save files.
        - **Original Bug**: It was `cb(null, './uploads')`. This was incorrect because the `uploads` directory is inside `routes`. The path is relative to the project root, not the current file.
        - **The Fix**: It was changed to `cb(null, './routes/uploads')` to point to the correct folder.
    - **`filename`**: Determines the name of the saved file.
        - **Original Bug**: The function signature was `(req, res, cb)` but it used a variable named `file`.
        - **The Fix**: The signature was corrected to `(req, file, cb)` to correctly access the uploaded file's details. A new, unique filename is generated using `Date.now()` to prevent files with the same name from overwriting each other.

- **`fileFilter`**: A function to control which files are accepted. In this case, it checks if the file's `mimetype` starts with `image/`, ensuring only images can be uploaded.

- **`upload = multer(...)`**: Creates the `multer` middleware with the defined `storage`, `fileFilter`, and a file size `limit` of 3MB.

#### API Routes (`router.get`, `router.post`, etc.)

- **`POST /`**: This route handles creating a new student.
    - **`upload.single('profile_pic')`**: This is the key middleware for the upload. It tells `multer` to expect a single file in a field named `profile_pic` from the request. `multer` processes the file, saves it, and adds a `file` object to the `req` object.
    - **`if (req.file)`**: After the student is created from the request body (`req.body`), this check sees if a file was uploaded. If so, it saves the generated `filename` to the `student.profile_pic` field before saving the student to the database.

- **The other routes (`GET`, `PUT`, `DELETE`)** are standard CRUD operations using Mongoose functions like `find()`, `findById()`, `findByIdAndUpdate()`, and `findByIdAndDelete()`.

---

## Summary of Fixes

1.  **Corrected Multer Parameters**: The function signatures for `destination` and `filename` in the `multer` configuration were fixed to use the `file` object correctly.
2.  **Corrected Upload Path**: The `destination` path was updated to point to the `routes/uploads` directory.
3.  **Enabled Static File Serving**: A middleware was added to `index.js` to make the `uploads` directory public, allowing images to be viewed in the browser.

This documentation should provide a clear guide to understanding, running, and further developing this project.